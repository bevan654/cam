(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{7357:function(e,t,r){Promise.resolve().then(r.bind(r,4425))},4425:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var i=r(7437),o=r(2265),n=r(7648);let s=["placed","confirmed","preparing","delivered"];function l(){let[e,t]=(0,o.useState)([]),[r,l]=(0,o.useState)(!0),[d,a]=(0,o.useState)(null),[c,p]=(0,o.useState)(10);(0,o.useEffect)(()=>{x();let e=setInterval(()=>{x(),p(10)},1e4),t=setInterval(()=>{p(e=>Math.max(0,e-1))},1e3);return()=>{clearInterval(e),clearInterval(t)}},[]);let x=async()=>{try{let e=localStorage.getItem("accessToken");if(!e){console.error("No access token found");return}let r=await fetch("/api/driver/all-orders",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(r.ok){let e=await r.json();t(e.orders||[])}else console.error("Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e)}finally{l(!1)}},u=async(e,r)=>{try{a(e);let i=localStorage.getItem("accessToken");if(!i){alert("Authentication required");return}console.log("Updating order status:",{orderId:e,newStatus:r});let o=await fetch("/api/driver/update-order-status",{method:"POST",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},body:JSON.stringify({orderId:e,status:r})});if(o.ok){let i=await o.json();console.log("API response:",i),t(t=>t.map(t=>t.id===e?{...t,status:r,updated_at:new Date().toISOString()}:t)),alert("Order status updated to: ".concat(r))}else{let e=await o.json();console.error("API error response:",e),alert("Failed to update order: ".concat(e.error))}}catch(e){console.error("Error updating order status:",e),alert("Failed to update order status")}finally{a(null)}},h=e=>({placed:"#6c757d",confirmed:"#17a2b8",preparing:"#ffc107",delivered:"#28a745"})[e]||"#6c757d",g=e=>({placed:"\uD83D\uDCDD",confirmed:"✅",preparing:"\uD83D\uDC68‍\uD83C\uDF73",delivered:"\uD83C\uDFAF"})[e]||"❓",f=e=>new Date(e).toLocaleString(),y=e=>e&&0!==Object.keys(e).length?(0,i.jsx)("div",{style:{marginTop:"5px"},children:Object.entries(e).map(e=>{let[t,r]=e;return(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginLeft:"10px"},children:[(0,i.jsxs)("strong",{children:[t,":"]})," ",Array.isArray(r)?r.join(", "):r]},t)})}):(0,i.jsx)("span",{style:{color:"#666",fontStyle:"italic"},children:"No customizations"});return r?(0,i.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:(0,i.jsx)("p",{children:"Loading orders..."})}):(0,i.jsxs)("div",{style:{padding:"20px"},children:[(0,i.jsx)("div",{style:{marginBottom:"20px"},children:(0,i.jsx)(n.default,{href:"/driver",style:{color:"#007bff",textDecoration:"none"},children:"← Back to Dashboard"})}),(0,i.jsx)("h1",{children:"All Orders"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",padding:"10px 15px",backgroundColor:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,i.jsx)("span",{style:{fontSize:"14px",color:"#666"},children:"\uD83D\uDD04 Auto-refresh:"}),(0,i.jsxs)("span",{style:{fontSize:"16px",fontWeight:"bold",color:c<=3?"#dc3545":"#28a745"},children:["Next poll in ",c,"s"]})]}),(0,i.jsx)("button",{onClick:()=>{x(),p(10)},disabled:r,style:{padding:"6px 12px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold",opacity:r?.6:1},children:r?"Refreshing...":"\uD83D\uDD04 Refresh Now"})]}),0===e.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:(0,i.jsx)("p",{children:"No orders found"})}):(0,i.jsx)("div",{style:{display:"grid",gap:"20px"},children:e.map(e=>{var t,r,o,n,l,a,c,p;return(0,i.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"20px",backgroundColor:"white",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"15px",paddingBottom:"15px",borderBottom:"1px solid #eee"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{style:{margin:"0 0 5px 0",color:"#333"},children:["Order #",e.id]}),(0,i.jsx)("p",{style:{margin:"0",color:"#666",fontSize:"14px"},children:f(e.created_at)})]}),(0,i.jsx)("div",{style:{textAlign:"right"},children:(0,i.jsxs)("span",{style:{padding:"6px 12px",backgroundColor:h(e.status),color:"white",borderRadius:"20px",fontSize:"12px",fontWeight:"bold"},children:[g(e.status)," ",e.status.replace(/_/g," ")]})})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#555"},children:"Customer Info"}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Name:"})," ",(null===(t=e.contact_info)||void 0===t?void 0:t.name)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Phone:"})," ",(null===(r=e.contact_info)||void 0===r?void 0:r.phone)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Email:"})," ",(null===(o=e.contact_info)||void 0===o?void 0:o.email)||"N/A"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#555"},children:"Delivery Details"}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Building:"})," ",(null===(n=e.delivery_details)||void 0===n?void 0:n.building)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Room:"})," ",(null===(l=e.delivery_details)||void 0===l?void 0:l.room)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Instructions:"})," ",(null===(a=e.delivery_details)||void 0===a?void 0:a.instructions)||"None"]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#555"},children:"Items"}),(0,i.jsxs)("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"6px",border:"1px solid #e9ecef"},children:[null===(c=e.items)||void 0===c?void 0:c.map((t,r)=>(0,i.jsxs)("div",{style:{padding:"10px 0",borderBottom:r<e.items.length-1?"1px solid #dee2e6":"none"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[(0,i.jsxs)("span",{style:{fontWeight:"bold"},children:[t.name||t.title||"Unknown Item"," x",t.quantity]}),(0,i.jsxs)("span",{style:{fontWeight:"bold"},children:["$",(t.price*t.quantity).toFixed(2)]})]}),t.customizations&&(0,i.jsx)("div",{style:{fontSize:"13px",color:"#666"},children:y(t.customizations)})]},r)),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 0 0 0",borderTop:"2px solid #dee2e6",fontWeight:"bold",fontSize:"16px"},children:[(0,i.jsx)("span",{children:"Total:"}),(0,i.jsxs)("span",{children:["$",(null===(p=e.total)||void 0===p?void 0:p.toFixed(2))||"0.00"]})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#555"},children:"Update Status"}),(0,i.jsx)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"15px"},children:s.map(t=>(0,i.jsx)("button",{onClick:()=>{console.log("Button clicked for status:",t),u(e.id,t)},disabled:d===e.id||e.status===t,style:{padding:"8px 16px",backgroundColor:e.status===t?h(t):"#f8f9fa",color:e.status===t?"white":"#333",border:"1px solid ".concat(e.status===t?h(t):"#dee2e6"),borderRadius:"6px",cursor:d===e.id?"not-allowed":"pointer",fontSize:"12px",fontWeight:"bold",opacity:d===e.id?.6:1},children:d===e.id&&e.status===t?"Updating...":t.replace(/_/g," ")},t))})]})]},e.id)})})]})}}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=7357)}),_N_E=e.O()}]);