(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{125:function(e,s,r){Promise.resolve().then(r.bind(r,6115))},6115:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return u}});var a=r(7437),n=r(2265),t=r(9376),c=r(7648),i=r(8734),l=r(6672);let d=[{status:"placed",description:"Order Placed",icon:"\uD83D\uDCDD",completed:!1,current:!1},{status:"confirmed",description:"Order Confirmed",icon:"✅",completed:!1,current:!1},{status:"picked_up",description:"Order Picked Up",icon:"\uD83D\uDE9A",completed:!1,current:!1},{status:"delivered",description:"Order Delivered",icon:"\uD83C\uDFAF",completed:!1,current:!1}];function o(){(0,t.useRouter)();let e=(0,t.useSearchParams)(),{user:s,loading:r,logout:o}=(0,i.a)(),[u,h]=(0,n.useState)(null),[m,j]=(0,n.useState)(null),[x,p]=(0,n.useState)(!0),[N,f]=(0,n.useState)(null),[g,v]=(0,n.useState)(new Date);(0,n.useEffect)(()=>{let s=e.get("orderId");if(s){h(s),D(s);let e=setInterval(()=>{D(s)},3e4);return()=>clearInterval(e)}p(!1),f("No order ID provided")},[e]);let D=async e=>{try{let s=localStorage.getItem("accessToken");if(!s){f("Authentication required"),p(!1);return}let r=await fetch("/api/validate-order?orderId=".concat(e),{headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(!r.ok){404===r.status?f("Order not found or access denied"):401===r.status?f("Authentication failed"):f("Failed to fetch order"),p(!1);return}let a=await r.json();j(a.order),v(new Date),p(!1)}catch(e){console.error("Error fetching order:",e),f("Failed to fetch order"),p(!1)}},b=e=>d.findIndex(s=>s.status===e),k=e=>{switch(e){case"placed":return"2-3 minutes";case"confirmed":return"5-10 minutes";case"picked_up":return"10-15 minutes";case"delivered":return"Delivered!";default:return"Unknown"}};if(x)return(0,a.jsx)(l.Gu,{message:"Loading Order...",submessage:"Please wait while we fetch your order details.",className:"tracking-hero-bg"});if(N||!m)return(0,a.jsx)(l.Te,{title:"Order Not Found",message:N||"Unable to find order details. Please check your order history or contact support.",primaryAction:{text:"View Orders",href:"/account",icon:"\uD83D\uDCCB"},secondaryAction:{text:"Order Again",href:"/restaurants",icon:"\uD83C\uDF7D️"},className:"tracking-hero-bg"});let y=(e=>{let s=b(e.status);return d.map((r,a)=>({...r,completed:a<=s,current:a===s&&"delivered"!==e.status}))})(m);return(0,a.jsxs)("div",{className:"App",children:[(0,a.jsxs)("div",{className:"tracking-hero-bg",children:[(0,a.jsx)(l.AI,{user:s,loading:r,onLogout:o}),(0,a.jsx)("section",{className:"tracking-hero",children:(0,a.jsx)("div",{className:"tracking-hero-container",children:(0,a.jsxs)("div",{className:"tracking-hero-content",children:[(0,a.jsx)("div",{className:"tracking-icon",children:"\uD83D\uDCCD"}),(0,a.jsx)("h1",{children:"Track Your Order"}),(0,a.jsxs)("p",{className:"order-id-modern",children:["Order #",m.id.slice(0,8)]}),(0,a.jsx)("p",{children:"Real-time updates on your order status and delivery progress"}),(0,a.jsxs)("div",{className:"tracking-hero-stats",children:[(0,a.jsxs)("div",{className:"modern-stat",children:[(0,a.jsxs)("span",{className:"modern-stat-number",children:["$",m.total.toFixed(0)]}),(0,a.jsx)("span",{className:"modern-stat-label",children:"Total"})]}),(0,a.jsxs)("div",{className:"modern-stat",children:[(0,a.jsx)("span",{className:"modern-stat-number",children:k(m.status)}),(0,a.jsx)("span",{className:"modern-stat-label",children:"Est. Time"})]}),(0,a.jsxs)("div",{className:"modern-stat",children:[(0,a.jsx)("span",{className:"modern-stat-number",children:"\uD83D\uDFE2"}),(0,a.jsx)("span",{className:"modern-stat-label",children:"Live"})]})]}),(0,a.jsxs)("div",{className:"last-updated-modern",children:["Last updated: ",g.toLocaleTimeString(),(0,a.jsx)("span",{className:"live-indicator",children:"\uD83D\uDFE2 Auto-updating"})]})]})})})]}),(0,a.jsx)("main",{className:"tracking-main",children:(0,a.jsx)("div",{className:"tracking-container-modern",children:(0,a.jsxs)("div",{className:"tracking-layout",children:[(0,a.jsxs)("div",{className:"tracking-timeline-modern",children:[(0,a.jsxs)("div",{className:"timeline-header",children:[(0,a.jsx)("h2",{children:"\uD83D\uDCE6 Order Progress"}),(0,a.jsx)("span",{className:"status-badge-tracking ".concat(m.status),children:m.status.replace("_"," ").toUpperCase()})]}),(0,a.jsx)("div",{className:"timeline-modern",children:y.map((e,s)=>(0,a.jsxs)("div",{className:"timeline-item-modern ".concat(e.completed?"completed":""," ").concat(e.current?"current":""),children:[(0,a.jsx)("div",{className:"timeline-icon-modern",children:e.completed?"✅":e.current?"⏳":e.icon}),(0,a.jsxs)("div",{className:"timeline-content-modern",children:[(0,a.jsx)("h3",{children:e.description}),(0,a.jsx)("p",{children:e.completed?"delivered"===e.status?"Delivered!":"Completed":e.current?"In progress - ".concat(k(e.status)):"Pending"}),e.current&&(0,a.jsx)("div",{className:"progress-bar",children:(0,a.jsx)("div",{className:"progress-fill"})})]})]},e.status))})]}),(0,a.jsxs)("div",{className:"tracking-details",children:[(0,a.jsxs)("div",{className:"details-card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("h3",{children:"\uD83D\uDCCB Order Summary"}),(0,a.jsxs)("span",{className:"order-total",children:["$",m.total.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"card-content",children:[(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"label",children:"Order Date:"}),(0,a.jsx)("span",{className:"value",children:new Date(m.created_at).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"label",children:"Payment:"}),(0,a.jsxs)("span",{className:"value",children:["\uD83D\uDCB3 ",m.payment_method]})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"label",children:"Items:"}),(0,a.jsxs)("span",{className:"value",children:[m.items.length," item",1!==m.items.length?"s":""]})]})]})]}),(0,a.jsxs)("div",{className:"details-card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h3",{children:"\uD83C\uDFE2 Delivery Address"})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsxs)("div",{className:"delivery-address",children:[(0,a.jsx)("div",{className:"address-line",children:(0,a.jsx)("strong",{children:m.delivery_details.building})}),(0,a.jsx)("div",{className:"address-line",children:m.delivery_details.room}),m.delivery_details.instructions&&(0,a.jsxs)("div",{className:"delivery-instructions",children:[(0,a.jsx)("span",{className:"instructions-label",children:"Instructions:"}),(0,a.jsx)("span",{className:"instructions-text",children:m.delivery_details.instructions})]})]})})]}),(0,a.jsxs)("div",{className:"details-card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h3",{children:"\uD83D\uDCDE Contact Info"})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsxs)("div",{className:"contact-info",children:[(0,a.jsxs)("div",{className:"contact-row",children:[(0,a.jsx)("span",{className:"contact-label",children:"Name:"}),(0,a.jsx)("span",{className:"contact-value",children:m.contact_info.name})]}),(0,a.jsxs)("div",{className:"contact-row",children:[(0,a.jsx)("span",{className:"contact-label",children:"Phone:"}),(0,a.jsx)("span",{className:"contact-value",children:m.contact_info.phone})]})]})})]}),(0,a.jsxs)("div",{className:"action-buttons-tracking",children:[(0,a.jsx)("button",{onClick:()=>D(m.id),className:"btn-refresh",disabled:x,children:x?"⏳ Refreshing...":"\uD83D\uDD04 Refresh Status"}),(0,a.jsx)(c.default,{href:"/account",className:"btn-view-orders-tracking",children:"\uD83D\uDCCB View All Orders"}),(0,a.jsx)(c.default,{href:"/restaurants",className:"btn-order-again",children:"\uD83C\uDF7D️ Order Again"})]}),(0,a.jsxs)("div",{className:"support-info-modern",children:[(0,a.jsx)("h4",{children:"Need Help?"}),(0,a.jsx)("p",{children:"\uD83D\uDCE7 support@campusangel.com"}),(0,a.jsx)("p",{children:"\uD83D\uDCF1 1-800-CAMPUS"}),(0,a.jsx)("p",{className:"auto-update",children:"\uD83D\uDD04 Status updates every 30 seconds"})]})]})]})})})]})}function u(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)(l.Gu,{}),children:(0,a.jsx)(o,{})})}},6672:function(e,s,r){"use strict";r.d(s,{AI:function(){return t},Gu:function(){return c},Te:function(){return l},ZG:function(){return i}});var a=r(7437),n=r(7648);function t(e){let{user:s,loading:r,onLogout:t}=e;return(0,a.jsx)("header",{className:"modern-header",children:(0,a.jsxs)("nav",{className:"modern-nav",children:[(0,a.jsx)(n.default,{href:"/",className:"modern-logo",children:"Campus Angel"}),(0,a.jsxs)("ul",{className:"modern-nav-links",children:[(0,a.jsx)("li",{children:(0,a.jsx)(n.default,{href:"/",children:"Home"})}),(0,a.jsx)("li",{children:(0,a.jsx)(n.default,{href:"/restaurants",children:"Restaurants"})}),(0,a.jsx)("li",{children:(0,a.jsx)(n.default,{href:"/account",children:"Account"})}),(0,a.jsx)("li",{children:(0,a.jsx)(n.default,{href:"/cart",children:"Cart"})})]}),(0,a.jsx)("div",{className:"modern-auth-buttons",children:r?(0,a.jsx)("div",{className:"auth-loading",children:"⏳"}):s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.default,{href:"/account",className:"btn btn-outline-modern",children:"My Account"}),(0,a.jsx)(n.default,{href:"/cart",className:"btn btn-primary-modern",children:"Cart"}),(0,a.jsx)("button",{onClick:t,className:"btn btn-secondary-modern",children:"Logout"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.default,{href:"/login",className:"btn btn-outline-modern",children:"Log In"}),(0,a.jsx)(n.default,{href:"/register",className:"btn btn-primary-modern",children:"Sign Up"})]})})]})})}function c(e){let{message:s="Loading...",submessage:r,className:n="hero-bg"}=e;return(0,a.jsx)("div",{className:"App",children:(0,a.jsxs)("div",{className:n,children:[(0,a.jsx)(t,{}),(0,a.jsx)("main",{className:"loading-main",children:(0,a.jsx)("div",{className:"loading-container-modern",children:(0,a.jsxs)("div",{className:"loading-content",children:[(0,a.jsx)("div",{className:"loading-spinner",children:"⏳"}),(0,a.jsx)("h2",{children:s}),r&&(0,a.jsx)("p",{children:r})]})})})]})})}function i(e){let{message:s="Authentication Required",submessage:r="You must be logged in to access this page.",className:c="hero-bg"}=e;return(0,a.jsx)("div",{className:"App",children:(0,a.jsxs)("div",{className:c,children:[(0,a.jsx)(t,{}),(0,a.jsx)("main",{className:"auth-required-main",children:(0,a.jsx)("div",{className:"auth-required-container-modern",children:(0,a.jsxs)("div",{className:"auth-required-content",children:[(0,a.jsx)("div",{className:"auth-icon",children:"\uD83D\uDD12"}),(0,a.jsx)("h2",{children:s}),(0,a.jsx)("p",{children:r}),(0,a.jsxs)("div",{className:"auth-actions-modern",children:[(0,a.jsx)(n.default,{href:"/login",className:"btn-auth-primary",children:"\uD83D\uDD11 Login"}),(0,a.jsx)(n.default,{href:"/register",className:"btn-auth-secondary",children:"\uD83D\uDCDD Register"})]})]})})})]})})}function l(e){let{title:s="Something went wrong",message:r,primaryAction:c,secondaryAction:i,className:l="hero-bg"}=e;return(0,a.jsx)("div",{className:"App",children:(0,a.jsxs)("div",{className:l,children:[(0,a.jsx)(t,{}),(0,a.jsx)("main",{className:"error-main",children:(0,a.jsx)("div",{className:"error-container-modern",children:(0,a.jsxs)("div",{className:"error-content",children:[(0,a.jsx)("div",{className:"error-icon",children:"❌"}),(0,a.jsx)("h2",{children:s}),(0,a.jsx)("p",{children:r}),(0,a.jsxs)("div",{className:"error-actions",children:[c&&(0,a.jsxs)(n.default,{href:c.href,className:"btn-error-primary",children:[c.icon," ",c.text]}),i&&(0,a.jsxs)(n.default,{href:i.href,className:"btn-error-secondary",children:[i.icon," ",i.text]})]})]})})})]})})}},8734:function(e,s,r){"use strict";r.d(s,{a:function(){return t}});var a=r(2265),n=r(9376);function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{requireAuth:s=!1,redirectToLogin:r=!1}=e,t=(0,n.useRouter)(),[c,i]=(0,a.useState)({user:null,loading:!0,error:null}),l=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("accessToken");if(!e){i({user:null,loading:!1,error:null}),s&&r&&t.push("/login");return}let a=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();i({user:e.user,loading:!1,error:null})}else if(401===a.status){let e=localStorage.getItem("refreshToken");if(e)try{let s=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(s.ok){let e=await s.json();localStorage.setItem("accessToken",e.session.accessToken),localStorage.setItem("refreshToken",e.session.refreshToken);let r=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e.session.accessToken),"Content-Type":"application/json"}});if(r.ok){let e=await r.json();i({user:e.user,loading:!1,error:null})}else d()}else d()}catch(e){console.error("Token refresh error:",e),d()}else d()}else d()}catch(e){console.error("Auth check error:",e),i({user:null,loading:!1,error:"Failed to check authentication"}),s&&r&&t.push("/login")}},[s,r,t]),d=()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i({user:null,loading:!1,error:null}),s&&r&&t.push("/login")};return(0,a.useEffect)(()=>{l()},[l]),{user:c.user,loading:c.loading,error:c.error,isAuthenticated:!!c.user,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i({user:null,loading:!1,error:null}),t.push("/")},refreshAuth:()=>{i(e=>({...e,loading:!0})),l()}}}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=125)}),_N_E=e.O()}]);