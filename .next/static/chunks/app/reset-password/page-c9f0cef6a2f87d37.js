(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{7177:function(e,s,a){Promise.resolve().then(a.bind(a,8886))},8886:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var r=a(7437),n=a(2265),t=a(9376),l=a(7648),o=a(4114);function c(){(0,t.useRouter)();let[e,s]=(0,n.useState)(""),[a,c]=(0,n.useState)(""),[i,d]=(0,n.useState)(!1),[h,u]=(0,n.useState)(""),[m,p]=(0,n.useState)(!1),[f,j]=(0,n.useState)(null),[x,g]=(0,n.useState)(!1),[N,w]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.hash.substring(1));if(e.get("error")){g(!0),w(e.get("error_description")||"An error occurred during password reset");return}let s=e.get("access_token");s?j(s):(g(!0),w("Invalid or missing reset token"))},[]);let v=async s=>{if(s.preventDefault(),d(!0),u(""),e!==a){u("Passwords do not match"),d(!1);return}if(e.length<8){u("Password must be at least 8 characters long"),d(!1);return}try{let s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e,accessToken:f})}),a=await s.json();s.ok?p(!0):u(a.error||"Failed to reset password")}catch(e){u("Network error. Please try again.")}finally{d(!1)}};return x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("main",{style:{marginTop:"80px",padding:"2rem"},children:(0,r.jsx)("div",{className:"auth-container",children:(0,r.jsxs)("div",{className:"auth-card",children:[(0,r.jsxs)("div",{className:"auth-header",children:[(0,r.jsx)("div",{className:"error-icon",children:"❌"}),(0,r.jsx)("h1",{children:"Password Reset Error"}),(0,r.jsx)("p",{children:N})]}),(0,r.jsx)("div",{className:"error-message",children:(0,r.jsx)("p",{children:"The password reset link is invalid or has expired. Please request a new password reset."})}),(0,r.jsxs)("div",{className:"auth-footer",children:[(0,r.jsx)(l.default,{href:"/forgot-password",className:"btn btn-primary",children:"Request New Reset"}),(0,r.jsxs)("p",{className:"auth-switch",children:["Remember your password?"," ",(0,r.jsx)(l.default,{href:"/login",className:"auth-link",children:"Sign in here"})]})]})]})})})]}):m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("main",{style:{marginTop:"80px",padding:"2rem"},children:(0,r.jsx)("div",{className:"auth-container",children:(0,r.jsxs)("div",{className:"auth-card",children:[(0,r.jsxs)("div",{className:"auth-header",children:[(0,r.jsx)("div",{className:"success-icon",children:"✅"}),(0,r.jsx)("h1",{children:"Password Reset Successfully"}),(0,r.jsx)("p",{children:"Your password has been updated. You can now sign in with your new password."})]}),(0,r.jsx)("div",{className:"success-message",children:(0,r.jsx)("p",{children:"Your password has been successfully reset. Please use your new password to sign in to your account."})}),(0,r.jsxs)("div",{className:"auth-footer",children:[(0,r.jsx)(l.default,{href:"/login",className:"btn btn-primary",children:"Sign In"}),(0,r.jsxs)("p",{className:"auth-switch",children:["Need help?"," ",(0,r.jsx)(l.default,{href:"/forgot-password",className:"auth-link",children:"Contact support"})]})]})]})})})]}):f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("main",{style:{marginTop:"80px",padding:"2rem"},children:(0,r.jsx)("div",{className:"auth-container",children:(0,r.jsxs)("div",{className:"auth-card",children:[(0,r.jsxs)("div",{className:"auth-header",children:[(0,r.jsx)("h1",{children:"Reset Your Password"}),(0,r.jsx)("p",{children:"Enter your new password below"})]}),h&&(0,r.jsx)("div",{className:"error-message",children:h}),(0,r.jsxs)("form",{onSubmit:v,className:"auth-form",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"password",children:"New Password"}),(0,r.jsx)("input",{type:"password",id:"password",name:"password",value:e,onChange:e=>s(e.target.value),required:!0,placeholder:"Enter your new password",className:"form-input",minLength:8}),(0,r.jsx)("small",{className:"form-help",children:"Password must be at least 8 characters long"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,r.jsx)("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:a,onChange:e=>c(e.target.value),required:!0,placeholder:"Confirm your new password",className:"form-input",minLength:8})]}),(0,r.jsx)("button",{type:"submit",disabled:i,className:"btn btn-primary auth-submit",children:i?"Resetting Password...":"Reset Password"})]}),(0,r.jsxs)("div",{className:"auth-footer",children:[(0,r.jsx)(l.default,{href:"/login",className:"back-to-login",children:"← Back to Login"}),(0,r.jsxs)("p",{className:"auth-switch",children:["Remember your password?"," ",(0,r.jsx)(l.default,{href:"/login",className:"auth-link",children:"Sign in here"})]})]})]})})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("main",{style:{marginTop:"80px",padding:"2rem"},children:(0,r.jsx)("div",{className:"auth-container",children:(0,r.jsx)("div",{className:"auth-card",children:(0,r.jsx)("div",{className:"loading",children:"Checking reset token..."})})})})]})}},4114:function(e,s,a){"use strict";a.d(s,{Z:function(){return o}});var r=a(7437),n=a(2265),t=a(9376),l=a(7648);function o(){let e=(0,t.useRouter)(),s=(0,t.usePathname)(),[a,o]=(0,n.useState)(!1),[c,i]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0),u=e=>{i(e)};(0,n.useEffect)(()=>(window.updateNavbarUser=u,()=>{delete window.updateNavbarUser}),[]),(0,n.useEffect)(()=>{(async()=>{let e=localStorage.getItem("accessToken"),s=localStorage.getItem("refreshToken");if(!e){h(!1),i(null);return}try{let a=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();i(e.user)}else if(401===a.status&&s)try{let e=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s})});if(e.ok){let s=await e.json();localStorage.setItem("accessToken",s.session.accessToken),localStorage.setItem("refreshToken",s.session.refreshToken);let a=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(s.session.accessToken),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();i(e.user)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null)}catch(e){console.error("Token refresh error:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null)}catch(e){console.error("Auth check error:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null)}finally{h(!1)}})()},[s]);let m=async()=>{let s=localStorage.getItem("accessToken");if(s)try{await fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:s})})}catch(e){console.error("Logout error:",e)}i(null),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),e.push("/")},p="/login"===s||"/register"===s;return(0,r.jsx)("header",{className:"site-header",children:(0,r.jsx)("div",{className:"container",children:(0,r.jsxs)("div",{className:"navbar",children:[(0,r.jsx)("div",{className:"navbar-brand",children:(0,r.jsxs)(l.default,{href:"/",className:"logo",children:[(0,r.jsx)("span",{className:"logo-icon",children:"\uD83D\uDC7C"}),(0,r.jsx)("span",{className:"logo-text",children:"Campus Angel"})]})}),(0,r.jsxs)("nav",{className:"navbar-nav ".concat(a?"open":""),children:[(0,r.jsx)(l.default,{href:"/",className:"nav-link",children:"Home"}),(0,r.jsx)(l.default,{href:"/restaurants",className:"nav-link",children:"Restaurants"}),(0,r.jsx)(l.default,{href:"/about",className:"nav-link",children:"About"}),(0,r.jsx)(l.default,{href:"/contact",className:"nav-link",children:"Contact"})]}),(0,r.jsxs)("div",{className:"navbar-actions",children:[d?(0,r.jsx)("div",{className:"auth-loading",children:(0,r.jsx)("span",{className:"loading-spinner",children:"⏳"})}):p?null:(0,r.jsx)(r.Fragment,{children:c?(0,r.jsx)("div",{className:"user-menu",children:(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsxs)("div",{className:"user-details",children:[(0,r.jsxs)("span",{className:"user-greeting",children:["Hello, ",c.firstName,"!"]}),(0,r.jsx)("span",{className:"user-email",children:c.email})]}),(0,r.jsxs)("div",{className:"user-actions",children:[(0,r.jsx)(l.default,{href:"/account",className:"btn btn-secondary account-btn",children:"My Account"}),(0,r.jsx)("button",{className:"btn btn-secondary logout-btn",onClick:m,children:"Logout"})]})]})}):(0,r.jsxs)("div",{className:"auth-buttons",children:[(0,r.jsx)(l.default,{href:"/login",className:"btn btn-secondary",children:"Login"}),(0,r.jsx)(l.default,{href:"/register",className:"btn btn-primary",children:"Register"})]})}),(0,r.jsxs)(l.default,{href:"/cart",className:"btn btn-secondary cart-btn",children:[(0,r.jsx)("span",{className:"cart-icon",children:"\uD83D\uDED2"}),(0,r.jsx)("span",{className:"cart-text",children:"Cart"})]}),(0,r.jsx)("button",{className:"mobile-menu-toggle",onClick:()=>o(!a),"aria-label":"Toggle mobile menu",children:(0,r.jsx)("span",{className:"hamburger ".concat(a?"open":"")})})]})]})})})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=7177)}),_N_E=e.O()}]);